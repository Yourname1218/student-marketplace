# 🎓 學生二手交易平台 - 技術架構說明

> 這份文件用簡單的方式說明網站使用的技術和運作流程

---

## 📚 目錄

1. [前端使用的工具](#前端使用的工具)
2. [後端使用的工具](#後端使用的工具)
3. [系統如何運作](#系統如何運作)
4. [完整流程圖](#完整流程圖)
5. [簡單總結](#簡單總結)

---

## 🎨 前端使用的工具

前端就是你在瀏覽器看到的畫面，負責顯示和互動。

### 核心框架

| 工具 | 用途 | 簡單說明 |
|------|------|----------|
| **React** | UI 框架 | 用來建立網頁的介面元件，像是按鈕、商品卡片、表單等 |
| **React Router** | 路由管理 | 讓網站可以切換不同頁面（首頁、登入頁、商品詳情頁），但不用重新載入整個網頁 |

### 狀態管理

| 工具 | 用途 | 簡單說明 |
|------|------|----------|
| **Zustand** | 狀態管理 | 用來記住使用者的登入狀態，即使重新整理網頁也不會登出 |

### 資料請求

| 工具 | 用途 | 簡單說明 |
|------|------|----------|
| **Axios** | HTTP 請求 | 用來跟後端伺服器要資料，例如：取得商品列表、登入帳號等 |

### 樣式設計

| 工具 | 用途 | 簡單說明 |
|------|------|----------|
| **Tailwind CSS** | CSS 框架 | 用來快速設計漂亮的介面，不用寫很多 CSS 程式碼 |

### 開發工具

| 工具 | 用途 | 簡單說明 |
|------|------|----------|
| **Vite** | 建置工具 | 開發時提供快速預覽，打包時把程式碼壓縮成檔案 |

---

## ⚙️ 後端使用的工具

後端就是伺服器，負責處理資料和邏輯。

### 核心框架

| 工具 | 用途 | 簡單說明 |
|------|------|----------|
| **Node.js** | 執行環境 | 讓 JavaScript 可以在伺服器上執行 |
| **Express** | Web 框架 | 建立 API 伺服器，接收前端的請求並回傳資料 |

### 資料庫

| 工具 | 用途 | 簡單說明 |
|------|------|----------|
| **SQLite** | 資料庫 | 用來儲存所有資料（使用者、商品、留言等），是一個檔案資料庫，不需要另外安裝資料庫軟體 |

### 安全功能

| 工具 | 用途 | 簡單說明 |
|------|------|----------|
| **bcryptjs** | 密碼加密 | 把使用者的密碼加密後儲存，即使資料庫被看也不會知道原始密碼 |
| **JWT** | 身份驗證 | 產生一個「通行證」（Token），使用者登入後可以用這個通行證來證明身份 |

### 其他工具

| 工具 | 用途 | 簡單說明 |
|------|------|----------|
| **CORS** | 跨域處理 | 讓前端和後端可以正常溝通（解決瀏覽器的安全限制） |

---

## 🔄 系統如何運作

### 前端運作方式

#### 開發階段
1. 使用 **Vite** 啟動開發伺服器
2. 當你修改程式碼時，網頁會自動更新（熱更新）
3. 前端發送 `/api` 開頭的請求時，Vite 會自動轉發到後端

#### 建置階段
1. 執行 `npm run build` 指令
2. **Vite** 會把 React 程式碼打包成靜態檔案
3. 這些檔案可以放在任何網頁伺服器上

#### 執行階段
1. 瀏覽器載入 HTML、CSS、JavaScript 檔案
2. **React** 開始執行，渲染網頁內容
3. **React Router** 根據網址決定顯示哪個頁面
4. **Zustand** 從瀏覽器的儲存空間讀取登入狀態
5. 當使用者操作時，**Axios** 發送請求到後端

### 後端運作方式

#### 啟動階段
1. **Express** 伺服器啟動，監聽 port 5000
2. 自動連接 **SQLite** 資料庫
3. 如果資料表不存在，會自動建立

#### 處理請求階段
1. 接收前端發來的 HTTP 請求
2. **CORS** 處理跨域問題
3. 解析 JSON 格式的資料
4. 根據路徑分發到對應的處理函數
5. 如果需要登入，檢查 **JWT Token** 是否有效
6. 執行資料庫操作（查詢、新增、修改、刪除）
7. 回傳 JSON 格式的結果給前端

---

## 📊 完整流程圖

### 簡單版流程

```
使用者操作
    ↓
瀏覽器顯示網頁（React）
    ↓
使用者點擊按鈕或輸入資料
    ↓
前端發送請求（Axios）
    ↓
後端接收請求（Express）
    ↓
檢查身份（JWT）
    ↓
處理資料（SQLite）
    ↓
回傳結果
    ↓
前端更新畫面（React）
    ↓
使用者看到結果
```

### 詳細版流程

#### 1️⃣ 使用者開啟網站

```
使用者輸入網址 → 瀏覽器請求網頁 → Vite 提供 HTML/CSS/JS 檔案
```

#### 2️⃣ 前端載入

```
React 開始執行
    ↓
React Router 決定顯示哪個頁面
    ↓
Zustand 讀取登入狀態（如果有）
    ↓
渲染對應的頁面元件
```

#### 3️⃣ 使用者操作

**範例：使用者想要登入**

```
使用者輸入帳號密碼
    ↓
點擊「登入」按鈕
    ↓
React 元件觸發登入函數
```

#### 4️⃣ 前端發送請求

```
Axios 建立 HTTP 請求
    ↓
URL: http://localhost:3000/api/auth/login
    ↓
資料: { email: "xxx", password: "xxx" }
    ↓
Vite Proxy 轉發到後端（http://localhost:5000）
```

#### 5️⃣ 後端接收請求

```
Express 伺服器接收請求
    ↓
CORS 中間件處理跨域
    ↓
解析 JSON 資料
    ↓
路由分發到 authRoutes（登入處理函數）
```

#### 6️⃣ 身份驗證（如果需要）

```
檢查是否需要登入
    ↓
如果是，檢查 JWT Token
    ↓
Token 有效 → 繼續處理
Token 無效 → 回傳 401 錯誤
```

#### 7️⃣ 業務邏輯處理

**以登入為例：**

```
從資料庫查詢使用者（用 email）
    ↓
使用 bcryptjs 比對密碼
    ↓
密碼正確 → 產生 JWT Token
    ↓
回傳使用者資訊和 Token
```

#### 8️⃣ 資料庫操作

```
better-sqlite3 執行 SQL 查詢
    ↓
操作 database.db 檔案
    ↓
回傳查詢結果
```

#### 9️⃣ 後端回傳結果

```
Express 將結果轉成 JSON
    ↓
設定 HTTP 狀態碼（200 = 成功）
    ↓
透過 HTTP Response 回傳
```

#### 🔟 前端接收結果

```
Axios 接收 HTTP 回應
    ↓
如果是 401（未授權），自動登出使用者
    ↓
將 JSON 資料傳給 React 元件
```

#### 1️⃣1️⃣ 更新畫面

```
React 元件更新狀態（Zustand 或 useState）
    ↓
React 自動重新渲染
    ↓
使用者看到更新後的畫面
    ↓
例如：登入成功 → Navbar 顯示使用者名稱
```

---

## 🎯 實際範例：瀏覽商品列表

讓我們用一個實際例子來說明：

### 步驟 1：使用者開啟首頁

```
使用者輸入 http://localhost:3000
    ↓
瀏覽器載入 React 應用程式
    ↓
React Router 顯示 Home 頁面
```

### 步驟 2：頁面載入時自動取得商品

```
Home 元件執行 useEffect
    ↓
使用 Axios 發送 GET 請求
    ↓
URL: /api/products
```

### 步驟 3：後端處理

```
Express 接收 GET /api/products
    ↓
路由分發到 productRoutes
    ↓
執行 SQL 查詢：SELECT * FROM products
    ↓
JOIN 使用者表取得賣家資訊
    ↓
回傳商品陣列（JSON 格式）
```

### 步驟 4：前端顯示

```
Axios 接收商品資料
    ↓
更新 React 的 products 狀態
    ↓
React 重新渲染
    ↓
顯示商品卡片列表
    ↓
使用者看到所有商品
```

---

## 🔑 關鍵技術點說明

### 為什麼需要 Vite Proxy？

在開發時，前端跑在 port 3000，後端跑在 port 5000。瀏覽器有安全限制，不允許直接跨 port 請求。所以 Vite 會自動把 `/api` 開頭的請求轉發到後端，這樣就不會有跨域問題。

### 為什麼需要 JWT Token？

當使用者登入後，後端會給他一個 Token（就像通行證）。之後使用者要刊登商品、收藏商品時，前端會自動把這個 Token 放在請求裡，後端就知道是誰在操作。

### 為什麼密碼要加密？

如果資料庫被駭客入侵，他們看到的密碼是加密過的，無法知道原始密碼。這樣即使資料庫被看，使用者的帳號還是安全的。

### 為什麼用 SQLite？

SQLite 是一個檔案資料庫，不需要另外安裝資料庫軟體。所有資料都存在一個 `.db` 檔案裡，非常適合小型專案。

---

## 📦 資料流向總結

### 簡單記憶法

```
使用者 → 前端（React） → 後端（Express） → 資料庫（SQLite） → 回傳 → 前端更新 → 使用者看到結果
```

### 詳細說明

1. **使用者操作**：點擊、輸入、搜尋等
2. **前端處理**：React 元件執行對應的函數
3. **發送請求**：Axios 建立 HTTP 請求
4. **後端接收**：Express 接收並處理請求
5. **資料庫查詢**：SQLite 執行 SQL 指令
6. **回傳結果**：後端回傳 JSON 資料
7. **更新畫面**：React 更新狀態並重新渲染
8. **使用者看到**：畫面更新完成

---

## 💡 簡單總結

### 前端（你看到的）

- **React**：建立網頁介面
- **React Router**：切換不同頁面
- **Zustand**：記住登入狀態
- **Axios**：跟後端要資料
- **Tailwind CSS**：設計漂亮介面
- **Vite**：開發和打包工具

### 後端（你看不到的）

- **Express**：建立 API 伺服器
- **SQLite**：儲存所有資料
- **JWT**：身份驗證
- **bcryptjs**：加密密碼

### 運作流程

1. 使用者操作 → 前端發送請求
2. 後端接收 → 處理資料 → 查詢資料庫
3. 回傳結果 → 前端更新畫面
4. 使用者看到結果

---

## 🎓 學習建議

如果你想要更深入了解：

1. **React**：學習如何建立元件、使用狀態
2. **Express**：學習如何建立 API、處理請求
3. **SQLite**：學習 SQL 語法、資料庫設計
4. **JWT**：學習身份驗證的原理

這些都是現代網頁開發的基礎技術，學會了就可以建立各種網站！

---

**希望這份說明對你有幫助！** 🎉

